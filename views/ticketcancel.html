<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>예매취소</title>
</head>
<style>
        * {
            margin: 0px;
            padding: 0px;
        }

        header {
            width: 100%;
            height: 100px;
            background-color: #ff0;
            border: 1px solid #000;
        }

        footer {
            width: 100%;
            height: 100px;
            background-color: #ff0;
            border: 1px solid #000;
        }

        wrapper {
            width: 1200px;
            background-color: #fa0;
            border: 1px solid #000;
            margin: auto;
            display: block;
        }

        .ticketprice {
            border: 1px solid #000;
            width: 100%px;
            margin: auto;
            display: block;
            height: 300px;
        }

        img {
            width: 100px;
            height: 150px;
        }
        div {
            display: flex;
        }
    </style>
    <script>
        window.onload = function() {
            

            let resvId = document.querySelector('#resv_id').value
            document.querySelector('#paymentcancel').addEventListener('click', (e)=>{
                fetch(`/desc/payment/cancel`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({resvId: resvId})
                })
                .then(res => res.json())
                .then(data => {
                    console.log(data)
                    if(data.msg=='success') {
                        alert('환불완료')
                        location.href='/mypage/reserveSelect'    
                    }
                        
                })
                .catch(err => console.log('에러 :', err.message))
                
            })
        }
        
    </script>
<body>
    <header>헤더</header>
    <wrapper>
        <div>
            <img src=../../img/{{io.poster_url}}>
            
        </div>
        <div>
            뮤지컬  〈{{io.perf_name}}〉<br/>
            {{io.schedule_date}} {{schedule_time}}
        </div>
        <section class="ticketprice">
            <input type="hidden" id="resv_id" value="{{io.resv_id}}">
            예매자 : {{io.user_name}}
            <hr>
            예매 번호 : {{io.resv_number}}
            <br>
            예매일 : {{io.payment_date}}
            <br>
            예매 좌석 : <br/>
            {% for seats in io.seats %}
            {{ seats.area }}구역 {{ seats.seat_row }}열 {{seats.seat_number}}번 ({{ seats.grade_code }}석)
            {% endfor %}
            <br>
            예매 수량 : {{io.resv_count}}
            <br>
            결제 수단 : {{io.payment_method}}
            <br>
            할인 전 금액 : {{io.total_amount}}
            <br>
            할인율 : {{io.discount_rate}}
            <br>
            최종 결제 금액 : {{io.final_amount}}
            
        </section>
    
        <section>
            결제 취소
            <input type="button" value="취소하기" id="paymentcancel">
        </section>
    </wrapper>
    <footer>푸터</footer>
</body>
</html>


<!-- 예매 내역 안에 취소하기 버튼 -> id -> 취소 페이지에 전달 -> 전달된 값으로 넌적스 화면 출력 -> 결제 취소 누르면 -> id값을 넘겨주는데(payment.id를 join 상태 ) -> 예매 내역 예매 상태 표시 다르게  -->