<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coupon</title>
    <script>
        window.addEventListener('DOMContentLoaded', function(){
            let cnt = "{{cnt}}"
            let totprice = "{{ptot}}"
            let use = 0
            let arr = []
            let hidden = document.querySelector(".hidden")
            document.querySelector(".total_price_btn").value = totprice+"원 결제하기"
            document.querySelectorAll(".coupon_ck").forEach(cck =>{
                console.log(hidden.value)
                cck.addEventListener('click', ()=>{
                    if (cck.checked == true){
                        use++
                        totprice -= eval(cck.classList[2])
                        arr.push(
                            {
                                coupon_name: cck.classList[1],
                                discount_price: cck.classList[2]
                            }
                            
                        )
                        hidden.value = JSON.stringify(arr)

                        if (use > cnt){
                            alert('쿠폰 선택 안됨')
                            cck.checked = false
                            use--
                            totprice += eval(cck.classList[2])
                            arr.pop()
                            hidden.value = JSON.stringify(arr)


                        }
                        document.querySelector(".total_price_btn").value = totprice+"원 결제하기"
                    }
                    else {
                        use--
                        totprice += eval(cck.classList[2])
                        arr.pop()
                        hidden.value = JSON.stringify(arr)

                        document.querySelector(".total_price_btn").value = totprice+"원 결제하기"
                    }
                })
            })

            let frm = document.forms.frm
            document.querySelector(".total_price_btn").onclick = function() {
                frm.submit()
            }
            
        })

        
    </script>
</head>
<body>
    <h1>coupon데이터</h1>
    <div class="coupon_menu">
        {% for i in coupon %}
        <label>
        <input type="checkbox" class="coupon_ck {{i.coupon_name}} {{i.discount_price}}">
        {{i.cid}} {{i.coupon_name}} {{i.discount_price}}<br/>
        </label>
        {% endfor %}

    </div>
    <div class="side_info">
        {% for i in temp_data %}
        좌석등급 {{i.grade}} {{i.area}}구역 {{i.s_row}}열 {{i.s_col}} {{i.price}}원<br/>
        {% endfor %}

        {{seat.year}} {{seat.month}} {{seat.day}} {{seat.choice_time}}회차
        


    </div>
    <form action="/desc/payment" name="frm" method="POST">
        <input type="hidden" name="items" class="hidden">
    <input type="submit" class="total_price_btn">
    </form>
</body>
</html>