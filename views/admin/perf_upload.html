<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì—° ë“±ë¡</title>
</head>
<style>
    /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë¦¬ì…‹ ë° í°íŠ¸ --- */
    body {
        font-family: Arial, sans-serif;
        background-color: #f8f8f8;
        color: #333;
        margin: 0;
        padding: 0;
    }

    h1 {
        text-align: center;
        color: #1f3f6e;
        padding: 20px 0;
        margin-bottom: 0;
    }

    hr {
        border: none;
        border-top: 1px solid #ccc;
        margin: 20px 0;
    }

    /* --- í¼ ì»¨í…Œì´ë„ˆ (Grid ë ˆì´ì•„ì›ƒ) --- */
    .admin-form-wrapper {
        max-width: 850px;
        margin: 20px auto;
        padding: 30px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* í¼ ë‚´ë¶€ì˜ ì£¼ìš” ì…ë ¥ í•„ë“œë“¤ì„ Gridë¡œ ë°°ì¹˜ */
    .input-grid-section {
        display: grid;
        /* ë ˆì´ë¸” 120px, í•„ë“œ 1fr */
        grid-template-columns: 120px 1fr; 
        gap: 15px 20px; 
        align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        margin-bottom: 20px;
    }

    /* Grid ë ˆì´ë¸” ìŠ¤íƒ€ì¼ */
    .input-grid-section > label, 
    .input-grid-section > div:first-child:not(.date-range-group) { /* divë¡œ ê°ì‹¸ì§€ ì•Šì€ ë ˆì´ë¸”ì—ë„ ì ìš© */
        font-weight: 600;
        color: #555;
    }

    /* ì…ë ¥ í•„ë“œ (input, select) ê³µí†µ ìŠ¤íƒ€ì¼ */
    .input-grid-section input[type="text"],
    .input-grid-section input[type="date"],
    .input-grid-section select,
    .admin_tb_cast select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 100%;
        box-sizing: border-box; /* íŒ¨ë”©ì´ ë„ˆë¹„ë¥¼ ëŠ˜ë¦¬ì§€ ì•Šë„ë¡ */
    }

    /* íŒŒì¼ ì…ë ¥ í•„ë“œ (ê¸°ë³¸ ìŠ¤íƒ€ì¼ ìˆ¨ê¹€ ë° ì»¤ìŠ¤í…€ ë ˆì´ë¸” ì ìš© ê¶Œì¥) */
    input[type="file"] {
        padding: 0;
        border: none;
    }

    /* --- ë‚ ì§œ ì…ë ¥ ê·¸ë£¹ (Flexbox) --- */
    .date-range-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .date-range-group input {
        flex-grow: 1;
    }
    /* ~ ê¸°í˜¸ì˜ ê³µê°„ í™•ë³´ */
    .date-range-group span {
        color: #333;
    }

    /* --- ì¢Œì„ ê°€ê²© ê·¸ë£¹ (R, S, A) --- */
    .seat-price-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3ê°œì˜ ê°€ê²©ì„ 3ì—´ë¡œ ë°°ì¹˜ */
        gap: 15px;
        margin-top: 10px;
        grid-column: 2 / 3;
    }
    .seat-price-container div {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .seat-price-container input {
        flex-grow: 1;
        text-align: right;
    }
    .seat-price-label {
        grid-column: 1 / 2; /* "ì¢Œì„ë³„ ê°€ê²©" ë ˆì´ë¸”ì„ ì²« ì—´ì— ê³ ì • */
    }
    /* ğŸ’¡ [ì¶œì—° ë°°ìš° ê´€ë¦¬] ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .admin_upload_actor {
        /* Flexbox ì„¤ì •: í•­ëª©ë“¤ì„ ê°€ë¡œë¡œ ë‚˜ì—´ */
        display: flex;
        flex-wrap: wrap; 
        justify-content: flex-start; 
        align-items: flex-start;
        
        padding: 15px 5px;
        margin-bottom: 20px;
        min-height: 100px; /* ë°°ìš°ê°€ ì—†ë”ë¼ë„ ì˜ì—­ì„ í™•ë³´ */
        border: 1px solid #ddd; /* êµ¬ë¶„ì„ ì„ ì¶”ê°€í•˜ì—¬ ì˜ì—­ì„ ëª…í™•íˆ í•¨ */
        border-radius: 6px;
        background-color: #fff;
    }
    /* --- ì¶œì—° ëª©ë¡ (ë°°ìš° ê°¤ëŸ¬ë¦¬) --- */
    .admin_actor_list {
        overflow-y: auto; 
        max-height: 250px; 
        display: flex; 
        flex-wrap: wrap;
        padding: 15px 5px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background-color: #f9f9f9;
        margin-bottom: 20px;
    }

    .admin_actor_info {
        width: 100px; /* ì¹´ë“œ ë„ˆë¹„ ê³ ì • */
        text-align: center;
        margin-right: 15px;

        padding: 5px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border 0.2s, background-color 0.2s;
        vertical-align: top;
    }
    .admin_actor_info:hover {
        background-color: #efefef;
        border-radius: 4px;
    }
    .admin_actor_info img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 50%;
        margin-bottom: 5px;
        border: 1px solid #ccc;
    }
    .admin_actor_info p {
        font-size: 0.8em;
        margin: 0;
        white-space: normal; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ í—ˆìš© */
    }

    /* --- ì¶œì—° ë°°ì—­ í…Œì´ë¸” --- */
    .admin_tb_cast {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    .admin_tb_cast th, .admin_tb_cast td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }
    .admin_tb_cast tr:first-child {
        background-color: #e9ecef;
        font-weight: bold;
        color: #333;
    }
    .admin_tb_cast td:last-child {
        text-align: center;
        width: 50px;
    }
    .admin_tb_cast select {
        /* í…Œì´ë¸” td ë‚´ì—ì„œ selectê°€ td ë„ˆë¹„ë¥¼ ê½‰ ì±„ìš°ë„ë¡ ì„¤ì • */
        width: 100%;
        /* ê¸°ë³¸ ë¸Œë¼ìš°ì € í™”ì‚´í‘œë¥¼ ìˆ¨ê¸°ê³  ì‹¶ë‹¤ë©´ appearance ì†ì„±ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. */
        /* appearance: none;
        -webkit-appearance: none;
        background-image: url('data:image/svg+xml;utf8,<svg ...>'); (ì»¤ìŠ¤í…€ í™”ì‚´í‘œ) */
    }

    /* --- ë°°ì—­ ì¶”ê°€ ì…ë ¥ í•„ë“œ --- */
    .cast-add-group {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-top: 10px;
    }
    .cast-add-group input[type="text"] {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        flex-grow: 1;
    }
    #admin_tb_add_btn {
        padding: 8px 20px;
        background-color: #5a80d4;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    /* --- ìµœì¢… ë²„íŠ¼ ê·¸ë£¹ --- */
    .final-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
        padding-top: 20px;
    }
    #btn_upload {
        padding: 10px 30px;
        background-color: #1f3f6e; /* ì§„í•œ ë‚¨ìƒ‰ */
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    #btn_upload:hover {
        background-color: #2a538d;
    }
    .final-buttons a {
        text-decoration: none;
        padding: 10px 30px;
        border: 1px solid #ccc;
        border-radius: 6px;
        color: #555;
        background-color: #fff;
        line-height: 1.5; /* ë²„íŠ¼ê³¼ ë†’ì´ ë§ì¶”ê¸° */
    }
    .removeBtn {
        background-color: #dc3545; /* ë¹¨ê°„ìƒ‰ ë°°ê²½ */
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .castBtn {
        background-color: #007bff; /* íŒŒë€ìƒ‰ ë°°ê²½ */
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
    }

    .initCastBtn {
        background-color: #6c757d; /* íšŒìƒ‰ ë°°ê²½ */
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
    }    


    /* 1. ì…€ë ‰íŠ¸ í•„ë“œ ê·¸ë£¹ì— Flexbox ì ìš© */
    .venue_select_group {
        display: flex;
        gap: 10px; /* Selectì™€ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
        align-items: center;
        width: 100%; /* ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ ì±„ìš°ê¸° */
    }

    /* 2. Select í•„ë“œê°€ ë‚¨ì€ ê³µê°„ì„ ì±„ìš°ë„ë¡ ì„¤ì • */
    .venue_select_group select {
        flex-grow: 1; /* Selectê°€ ìµœëŒ€í•œ ë„“ê²Œ í™•ì¥ */
        /* ğŸ’¡ ì—¬ê¸°ì„œ ê¸°ì¡´ input-grid-section ìŠ¤íƒ€ì¼ì„ ìƒì†ë°›ìŠµë‹ˆë‹¤. */
    }

    /* 3. ì¡°íšŒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #search_venue_btn {
        flex-shrink: 0; /* ë²„íŠ¼ í¬ê¸° ìœ ì§€ */
        padding: 8px 15px;
        background-color: #1f3f6e; /* ê´€ë¦¬ì UI íŒŒë€ìƒ‰ ê³„ì—´ */
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        
        /* ğŸ’¡ Selectì™€ ë†’ì´ë¥¼ ë§ì¶”ê¸° ìœ„í•´ box-sizing ì†ì„± ì¶”ê°€ */
        box-sizing: border-box; 
    }

    #search_venue_btn:hover {
        background-color: #2a528a;
    }
</style>
<script>
    window.onload = function() {
        let ipAddCast = document.querySelector("#admin_tb_add_cast")
        let ipAddBg = document.querySelector("#admin_tb_add_bg")
        let tbCast = document.querySelector(".admin_tb_cast")
        var castArrIdx = 0;
        var castArr = []
        var actArr = []
        var perfCastArr = []

        document.querySelector("#admin_tb_add_btn").onclick = (e)=>{
            const newCastData = {
                id: `tempCast${castArrIdx}`,
                castName: ipAddCast.value,
                castBg: ipAddBg.value
            }

            let trCast = document.createElement("tr")
            trCast.id = `trCast${castArrIdx}`
            trCast.dataset.id = castArrIdx;

            let tdCastName = document.createElement("td")
            tdCastName.innerHTML = ipAddCast.value
            ipAddCast.value = '';

            let tdCastBg = document.createElement("td")
            tdCastBg.innerHTML = ipAddBg.value
            ipAddBg.value = '';

            let tdRemoveBtn = document.createElement("td")
            let removeBtn = document.createElement("input")
            removeBtn.setAttribute("type", "button")
            removeBtn.setAttribute("value", "-")
            removeBtn.className = 'removeBtn'
            removeBtn.id = `removeBtn${castArrIdx}`
            removeBtn.addEventListener("click", (e) => {
                tbCast.removeChild(trCast)
                
                const removeId = Number(trCast.dataset.id); 
        
                castArr = castArr.filter(item => {
                    let filterId = item.id.split('tempCast')[1]
                    return filterId != removeId
                });

                perfCastArr = perfCastArr.filter((item, index) => {
                    // trCast.dataset.idëŠ” ë°°ì—­ì´ ìƒì„±ë  ë•Œì˜ ê³ ìœ  ID(castArrIdx)ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤.
                    // castArrì™€ perfCastArrëŠ” ìƒì„± ì‹œì ì— ì¸ë±ìŠ¤ë¥¼ ê³µìœ í–ˆìœ¼ë¯€ë¡œ, 
                    // í•´ë‹¹ ì¸ë±ìŠ¤(removeId)ë¥¼ ì œê±°í•˜ëŠ” ê²ƒì´ ë§ìŠµë‹ˆë‹¤.
                    // ë‹¤ë§Œ, castArrëŠ” ë‚´ë¶€ idë¡œ í•„í„°ë§í–ˆìœ¼ë¯€ë¡œ, perfCastArrë„ í•´ë‹¹ ì¸ë±ìŠ¤ë¥¼ ì œê±°í•´ì•¼ í•©ë‹ˆë‹¤.
                    // *ì£¼ì˜*: castArrIdxë¥¼ ì‚¬ìš©í•œ trCast.dataset.idëŠ” ì¸ë±ìŠ¤ê°€ ì¬ë°°ì—´ë˜ë©´ ë” ì´ìƒ ë°°ì—´ ì¸ë±ìŠ¤ì™€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                    // ê°€ì¥ ì•ˆì „í•œ ë°©ë²•ì€ `perfCastArr.splice(removeId, 1)` í›„ ëª¨ë“  `data-id`ë¥¼ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜,
                    // ë‹¨ìˆœí•˜ê²Œ `perfCastArr`ì—ì„œë„ í•„í„°ë§ì„ ì§„í–‰í•˜ì—¬ ê¸¸ì´ë¥¼ ë§ì¶”ëŠ” ê²ƒì…ë‹ˆë‹¤.
                    return index !== removeId;
                });
                        
                console.log('ì‚­ì œ í›„ castArr:', castArr)
            })
            tdRemoveBtn.append(removeBtn)


            let tdActorList = document.createElement("td")
            let slActor = document.createElement("select")
             
            for(const actor of actArr) {
                let optActor = document.createElement("option")
                optActor.value = `${actor.id}`
                optActor.innerHTML = `${actor.name}`
                slActor.append(optActor)
            }

            slActor.id=`selectActor${castArrIdx}`
            tdActorList.append(slActor)

            let tdCastBtn = document.createElement("td")
            let castBtn = document.createElement("input")
            castBtn.setAttribute("type", "button")
            castBtn.setAttribute("value", "ì§€ì •")
            castBtn.id = `castBtn${castArrIdx}`
            castBtn.className = `castBtn`
            
            let tdCastList = document.createElement("td")
            let spanCastList = document.createElement("span")
            spanCastList.id = `castList${castArrIdx}`
            tdCastList.append(spanCastList)

            // let prefCastData = {}
            
            
            castBtn.addEventListener("click", (e) => {
                console.log(slActor.value, slActor.options[slActor.selectedIndex].innerHTML.trim())
                let selectOptionName = slActor.options[slActor.selectedIndex].innerHTML.trim()
                //let cast_id = castBtn.id.split('castBtn')[1]
                let castIdx = Number(trCast.dataset.id); // ğŸ‘ˆ í•´ë‹¹ ë°°ì—­ì˜ ì¸ë±ìŠ¤ ê°€ì ¸ì˜¤ê¸°
                let castKey = `tempCast${castIdx}`;      // ğŸ‘ˆ í‚¤ ìƒì„± (tempCast0, tempCast1 ë“±)

                // perfCastArrì˜ í•´ë‹¹ ì¸ë±ìŠ¤ ê°ì²´ì— ì ‘ê·¼
                let currentPrefCast = perfCastArr[castIdx];

                if(spanCastList.innerHTML) {
                    
                    spanCastList.innerHTML += `,${selectOptionName}`
                    currentPrefCast[`${castKey}`] += `,${slActor.value.split('actor')[1]}`
                } else {
                    spanCastList.innerHTML = `${selectOptionName}`
                    currentPrefCast[`${castKey}`] = `${slActor.value.split('actor')[1]}`
                }
                console.log("perfCastArr",perfCastArr)
            })
            tdCastBtn.append(castBtn)

            let tdInitCast = document.createElement("td")
            let initCastBtn = document.createElement("input")
            initCastBtn.setAttribute("type", "button")
            initCastBtn.setAttribute("value", "ì´ˆê¸°í™”")
            initCastBtn.id = `initCastBtn${castArrIdx}`
            initCastBtn.className = `initCastBtn`
            tdInitCast.append(initCastBtn)
            initCastBtn.addEventListener("click", (e) => {
                let castIdx = Number(trCast.dataset.id); // ğŸ‘ˆ í•´ë‹¹ ë°°ì—­ì˜ ì¸ë±ìŠ¤ ê°€ì ¸ì˜¤ê¸°
                let castKey = `tempCast${castIdx}`;

                spanCastList.innerHTML = ''
                perfCastArr[castIdx][castKey] = '' // ğŸ‘ˆ ì˜¬ë°”ë¥¸ ë°°ì—´ ì¸ë±ìŠ¤ì— ì ‘ê·¼
                console.log("ì´ˆê¸°í™” í›„ perfCastArr:", perfCastArr)
            })


            trCast.append(tdCastName)
            trCast.append(tdCastBg)
            trCast.append(tdRemoveBtn)
            trCast.append(tdActorList)
            trCast.append(tdCastBtn)
            trCast.append(tdCastList)
            trCast.append(tdInitCast)
            tbCast.append(trCast)

            castArr.push(newCastData)
            perfCastArr.push({})
            castArrIdx++;
        }

        let divUploadActor = document.querySelector(".admin_upload_actor")
        let divActorList = document.querySelector(".admin_actor_list")
        let divActorInfoList = document.querySelectorAll('.admin_actor_info')
        
        
        for(const divActorInfo of divActorInfoList) {
            divActorInfo.addEventListener("click", (e)=>{
                console.log(divActorInfo.parentNode)
                console.log(divActorInfo.parentNode===divActorList)
                let actorInfoId = divActorInfo.id.split('actor')[1]
                divActorInfo.dataset.id = actorInfoId
                if(divActorInfo.parentNode===divActorList) {
                    divActorList.removeChild(divActorInfo)
                    divUploadActor.appendChild(divActorInfo)
                    let pActorName = document.querySelector(`#actorName${actorInfoId}`)
                    let actorName = pActorName.innerHTML
                    let actorData = {id:`actor${actorInfoId}`, name:actorName}
                    actArr.push(actorData)
                } else {
                    divUploadActor.removeChild(divActorInfo)
                    divActorList.appendChild(divActorInfo)
                    console.log(`$pop ${actorInfoId}`)
                    const removeId = Number(divActorInfo.dataset.id); 
            
                    actArr = actArr.filter(item => {
                        console.log(`${item.id} : ${removeId} = ${item.id != removeId}`)
                        return item.id != removeId
                    });
                    
                    console.log('ì‚­ì œ í›„ actArr:', actArr)
                }
                console.log(actArr)
            })
        }

        let selectorTh = document.querySelector('#ftheator')
        let seatR = document.querySelector('#seatR')
        let selectedVenueId = 1
        selectorTh.addEventListener('change', (e)=>{
            console.log('theator change', e.target.value)
            selectedVenueId = e.target.value
            flag_search_venue = false
            // if(e.target.value=="1" || e.target.value=="2") {
            //     seatR.disabled = false
            // } else {
            //     seatR.disabled = true
            // }
        })


        let flag_search_venue = false
        let btn_search_venue = document.querySelector('#search_venue_btn')

        btn_search_venue.addEventListener('click', (e)=>{
            let iStartVal = document.querySelector('#iStart').value.trim()
            let iEndVal = document.querySelector('#iEnd').value.trim()
            let iVenueVal = document.querySelector('#iEnd').value.trim()

            if (iStartVal == '') {
                alert('ì¡°íšŒí•  ê³µì—° ì‹œì‘ ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            
            if (iEndVal == '') {
                alert('ì¡°íšŒí•  ê³µì—° ì¢…ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            if (new Date(iStartVal) > new Date(iEndVal)) {
                alert('ê³µì—° ì‹œì‘ ë‚ ì§œëŠ” ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                event.preventDefault();
                return;
            }

            let search_data = {
                start_date : iStartVal,
                end_date : iEndVal,
                venue_id : selectedVenueId
            }
            console.log(search_data)
            fetch(`/admin/upload/check`,{
                    method:'POST',
                    headers : {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(search_data)
                })     
            .then(answer=> answer.json())
            .then(data=> {
                    console.log(data)
                    if(data.msg=='success') {
                        alert('ê³µì—°ì¥ ì´ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤')
                        flag_search_venue = true
                        document.querySelector('#iStart').readOnly = true
                        document.querySelector('#iEnd').readOnly = true
                    } else {
                        alert(`ì„ íƒê¸°ê°„ë‚´ì— ë‹¤ë¥¸ ê³µì—°ì´ ìˆìŠµë‹ˆë‹¤.\n${data.start_date}~${data.end_date}ì™¸ ê¸°ê°„ì´ë‚˜ ë‹¤ë¥¸ ê³µì—°ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”`)
                    }
            })
            .catch(err=>console.log('ì—ëŸ¬ : ',err.message))
        })



        let btn_upload = document.querySelector('#btn_upload')

        btn_upload.addEventListener('click', (e)=>{
            let iNameVal = document.querySelector('#iName').value.trim()
            let isPosterSelected = document.querySelector('#iPoster').files.length > 0
            let isSynopsisSelected = document.querySelector('#iSynopsis').files.length > 0
            let iRunningVal = document.querySelector('#iRunning').value.trim()
            let iStartVal = document.querySelector('#iStart').value.trim()
            let iEndVal = document.querySelector('#iEnd').value.trim()
            let iSeatRVal = document.querySelector('#iSeatR').value.trim()
            let iSeatSVal = document.querySelector('#iSeatS').value.trim()
            let iSeatAVal = document.querySelector('#iSeatA').value.trim()

        // í…ìŠ¤íŠ¸/ë‚ ì§œ í•„ë“œ ê²€ì‚¬
            if (iNameVal === '') {
                alert('ê³µì—° ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            
            // íŒŒì¼ í•„ë“œ ê²€ì‚¬ (í¬ìŠ¤í„°)
            if (!isPosterSelected) {
                alert('í¬ìŠ¤í„° ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            
            // íŒŒì¼ í•„ë“œ ê²€ì‚¬ (ì‹œë†‰ì‹œìŠ¤)
            if (!isSynopsisSelected) {
                alert('ì‹œë†‰ì‹œìŠ¤ íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            
            if (iRunningVal === '') {
                alert('ëŸ°ë‹ íƒ€ì„(ê³µì—° ì‹œê°„)ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }

            if (iStartVal === '') {
                alert('ê³µì—° ì‹œì‘ ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            
            if (iEndVal === '') {
                alert('ê³µì—° ì¢…ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }

            if(!flag_search_venue) {
                alert('ì¡°íšŒë¡œ ê³µì—° ê¸°ê°„ì„ í™•ì¸í•˜ì„¸ìš”');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            
            // ì¢Œì„ ê°€ê²© í•„ë“œ ê²€ì‚¬ (ìˆ«ìí˜• ì…ë ¥ìœ¼ë¡œ ê°€ì •)
            if (iSeatRVal === '') {
                alert('Rì„ ê°€ê²©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            if (iSeatSVal === '') {
                alert('Sì„ ê°€ê²©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }
            if (iSeatAVal === '') {
                alert('Aì„ ê°€ê²©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                event.preventDefault(); // ì œì¶œ ì¤‘ë‹¨
                return;
            }

            // 3. (ì˜µì…˜) ë‚ ì§œ ìœ íš¨ì„± ì¶”ê°€ ê²€ì‚¬: ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìœ¼ë©´ ì•ˆ ë¨
            if (new Date(iStartVal) > new Date(iEndVal)) {
                alert('ê³µì—° ì‹œì‘ ë‚ ì§œëŠ” ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                event.preventDefault();
                return;
            }


            
            const uploadData = new FormData(document.uploadFrm)
            
            uploadData.append('castData', JSON.stringify(castArr))
            uploadData.append('prefCastData', JSON.stringify(perfCastArr))
            
            //ë‚´ìš©í™•ì¸
            for(const [kk,vv] of uploadData.entries()){
                console.log(`${kk} , ${vv}`)
            }

            fetch(`/admin/perf/upload`,{
                    method:'POST',
                    // header ë¶ˆí•„ìš” FormData ê°€ ìë™ ìƒì„±
                    body:uploadData
                })     
            .then(answer=> answer.text())
            .then(data=> {
                    console.log(data)
                    if(data=='success') {
                        alert('ê³µì—° ë“±ë¡ ì™„ë£Œ')
                        location.href='/admin/perf/list'
                    }
            })
            .catch(err=>console.log('ì—ëŸ¬ : ',err.message))
        })
    }
</script>
<body>

<div class="admin-form-wrapper">
    <h1>ê³µì—° ë“±ë¡</h1>
    <form action="/admin/perf/upload" method="POST" enctype="multipart/form-data" name="uploadFrm">
        
        <div class="input-grid-section">
            
            <label for="iName">ê³µì—°ì´ë¦„</label> 
            <input type="text" name="fname" id="iName">
            
            <label for="iPoster">í¬ìŠ¤í„°</label> 
            <input type="file" name="fposter" id="iPoster">
            
            <label for="iSynopsis">ì‹œë†‰ì‹œìŠ¤</label> 
            <input type="file" name="fsynopsis" id="iSynopsis">
            
            <label for="fgenre">ê³µì—°ì¥ë¥´</label> 
            <select name="fgenre">
                <option value="ì˜¤ë¦¬ì§€ë„">ì˜¤ë¦¬ì§€ë„</option>
                <option value="ì°½ì‘">ì°½ì‘</option>
                <option value="ë¼ì´ì„ ìŠ¤">ë¼ì´ì„ ìŠ¤</option>
                <option value="ë„Œë²„ë²Œí¼í¬ë¨¼ìŠ¤">ë„Œë²„ë²Œí¼í¬ë¨¼ìŠ¤</option>
            </select>
            
            <label for="iRunning">ëŸ¬ë‹íƒ€ì„</label> 
            <input type="text" name="frunning" id="iRunning">

            <label>ê³µì—°ê¸°ê°„</label>
            <div class="date-range-group">
                <input type="date" name="fstart" id="iStart">
                <span>~</span>
                <input type="date" name="fend" id="iEnd">
            </div>

            <label for="ftheator">ê³µì—°ì¥</label> 
            <div class="venue_select_group">
                <select name="ftheator" id="ftheator">
                    <option value="1">ìƒ¤ë¡¯ë°ì”¨ì–´í„°</option>
                    <option value="2">ë“œë¦¼ì”¨ì–´í„°</option>
                    <option value="3">ëŒ€í•™ë¡œì˜ˆìˆ ê·¹ì¥</option>
                    <option value="4">ì°½ì›ì„±ì‚°ì•„íŠ¸í™€</option>
                </select>
                <input type="button" id="search_venue_btn" value="ì¡°íšŒ"/>
            </div>
            
            <label class="seat-price-label">ì¢Œì„ë³„ ê°€ê²©</label>
            <div class="seat-price-container">
                <div>R<input type="text" name="fclassR" id="iSeatR"></div>
                <div>S<input type="text" name="fclassS" id="iSeatS"></div>
                <div>A<input type="text" name="fclassA" id="iSeatA"></div>
            </div>
            
        </div>
        <hr/>
        
        <h2>ì¶œì—° ë°°ìš° ê´€ë¦¬</h2>
        <div class="admin_upload_actor">
        </div>
        
        <h3>ì¶œì—° ëª©ë¡ (ì„ íƒ ê°€ëŠ¥í•œ ë°°ìš°)</h3>
        <div class="admin_actor_list">
            {% for actor in res %}
                <div class="admin_actor_info" id="actor{{actor.actor_id}}">
                    <div>
                        <img src="../../img/{{actor.actor_profile_url}}" alt="ë°°ìš° ì‚¬ì§„">
                    </div>
                    <p id="actorName{{actor.actor_id}}">
                        {{actor.actor_name}}({{actor.actor_birth_year}}/{{actor.actor_gender}})
                    </p>
                </div>
            {% endfor %}
        </div>

        <h3>ì¶œì—° ë°°ì—­ ì§€ì •</h3> 
        <table class="admin_tb_cast">
            <tr>
                <td>ë°°ì—­</td>
                <td>ì¤„ê±°ë¦¬</td>
                <td>ì‚­ì œ</td>
                <td>ë°°ìš° ì„ íƒ</td>
                <td>ì§€ì •</td>
                <td>ë°°ìš° ëª©ë¡</td>
                <td>ì´ˆê¸°í™”</td>
            </tr>
        </table>
        
        <div class="cast-add-group">
            ë°°ì—­ <input type="text" id="admin_tb_add_cast"/>
            ì¤„ê±°ë¦¬ <input type="text" id="admin_tb_add_bg"/>
            <input type="button" name="fadd" value="ì¶”ê°€" id="admin_tb_add_btn"/>
        </div>
        
        <hr/>
        
        <div class="final-buttons">
            <input type="button" value="ì—…ë¡œë“œ" id="btn_upload">
            <a href="/admin/perf">ë’¤ë¡œ</a>
        </div>
        <hr/>
    </form>
</div>
</body>
</html>